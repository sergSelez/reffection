import { useEffect, useRef, useState } from 'react';
import { gsap } from "gsap";
import { ScrollTrigger } from "gsap/ScrollTrigger";
import { SplitText } from "gsap/SplitText";

gsap.registerPlugin(SplitText, ScrollTrigger);

function PartnerPortraitHead() {
    const textRef = useRef(null);
    const [fontsLoaded, setFontsLoaded] = useState(false);

    useEffect(() => {
        // Проверяем, загружены ли шрифты
        const checkFonts = async () => {
            try {
                await document.fonts.ready;
                setFontsLoaded(true);
            } catch (error) {
                console.error('Error waiting for fonts:', error);
                setFontsLoaded(true); // В случае ошибки всё равно продолжаем
            }
        };

        checkFonts();
    }, []);

    useEffect(() => {
        if (!fontsLoaded) return;

        const text = textRef.current;
        if (!text) return;

        // Сначала разбиваем текст на строки
        const splitLines = new SplitText(text, {
            type: "lines",
            linesClass: "line-wrapper" // Обёртка для каждой строки
        });

        // Для каждой строки создаём внутренний блок с текстом
        splitLines.lines.forEach(line => {
            // Сохраняем исходный HTML строки
            const lineContent = line.innerHTML;

            // Очищаем строку и добавляем внутренний блок
            line.innerHTML = '';
            const innerLine = document.createElement('div');
            innerLine.className = 'line-inner';
            innerLine.innerHTML = lineContent;
            line.appendChild(innerLine);

            // Теперь разбиваем внутренний текст на слова/буквы если нужно
            // new SplitText(innerLine, {
            //     type: "words",
            //     wordsClass: "word",
            //     charsClass: "char"
            // });
        });

        // Анимируем внутренние блоки строк
        gsap.from(".line-inner", {
            scrollTrigger: {
                trigger: text,
                start: "top 80%",
                toggleActions: "play none none reverse"
            },
            duration: .4,
            y: "100%", // Теперь используем проценты для движения внутри родителя
            stagger: 0.13,
            ease: "power2.out"
        });

        return () => {
            if (splitLines && splitLines.revert) {
                splitLines.revert();
            }
            ScrollTrigger.getAll().forEach(t => t.kill());
        };
    }, [fontsLoaded]); // Зависимость от fontsLoaded

    return (
        <div className="partner_portrait_wrap-head section_title" ref={textRef}>
            Цель всех инструментов digital-маркетинга, от&nbsp;SEO до&nbsp;Я.&nbsp;Директа, одна&nbsp;&mdash; генерация обращений,
            так как бизнес ждет лиды и&nbsp;просит прогнозы по&nbsp;их&nbsp;приросту. Имплементация идентифи кации скрытых пользователей
            в&nbsp;продуктовый портфель партнера, вдвое увеличивает количество
            квалифицированных лидов, которые партнер генерирует своим клиентам через традиционные инструменты.
        </div>
        //         !isTablet ? (
        //     <div className="partner_portrait_wrap-head section_title" ref={textRef}>
        //         Цель всех инструментов digital-маркетинга, от&nbsp;SEO до&nbsp;Я.
        //         Директа, одна&nbsp;-
        //         <span>
        //             &nbsp;
        //             генерация обращений,
        //             <svg width="462" height="68" viewBox="0 0 462 68" fill="none" xmlns="http://www.w3.org/2000/svg">
        //                 <path
        //                     d="M460.5 30C460.5 31.7969 459.095 33.6887 456.058 35.6244C453.05 37.5419 448.581 39.41 442.778 41.1996C431.18 44.7764 414.371 48.0043 393.57 50.7174C351.975 56.1428 294.498 59.5 231 59.5C167.502 59.5 110.025 56.1428 68.4301 50.7174C47.6293 48.0043 30.8205 44.7764 19.2219 41.1996C13.419 39.41 8.94979 37.5419 5.94154 35.6244C2.90478 33.6887 1.5 31.7969 1.5 30C1.5 28.2031 2.90478 26.3113 5.94154 24.3756C8.94979 22.4581 13.419 20.59 19.2219 18.8004C30.8205 15.2236 47.6293 11.9957 68.4301 9.2826C110.025 3.85724 167.502 0.5 231 0.5C294.498 0.5 351.975 3.85724 393.57 9.2826C414.371 11.9957 431.18 15.2236 442.778 18.8004C448.581 20.59 453.05 22.4581 456.058 24.3756C459.095 26.3113 460.5 28.2031 460.5 30Z"
        //                     stroke="#B3B3B3" className="svg-elem-1"></path>
        //                 <path d="M460.86 21.9736C461.438 38.532 358.995 55.5491 232.047 59.9822C105.099 64.4153 1.71861 54.5858 1.14038 38.0273" stroke="#B3B3B3"
        //                     className="svg-elem-2"></path>
        //             </svg>
        //             &nbsp;
        //         </span>
        //         так как
        //         бизнес ждет лиды и&nbsp;просит прогнозы по&nbsp;их&nbsp;приросту.
        //         <span className='line'>
        //             Имплементация идентификации скрытых пользователей
        //             <div className="line-line"></div>
        //         </span>
        //         <span>
        //             &nbsp;
        //             в продуктовый портфель
        //             <svg width="462" height="68" viewBox="0 0 462 68" fill="none" xmlns="http://www.w3.org/2000/svg">
        //                 <path
        //                     d="M460.5 30C460.5 31.7969 459.095 33.6887 456.058 35.6244C453.05 37.5419 448.581 39.41 442.778 41.1996C431.18 44.7764 414.371 48.0043 393.57 50.7174C351.975 56.1428 294.498 59.5 231 59.5C167.502 59.5 110.025 56.1428 68.4301 50.7174C47.6293 48.0043 30.8205 44.7764 19.2219 41.1996C13.419 39.41 8.94979 37.5419 5.94154 35.6244C2.90478 33.6887 1.5 31.7969 1.5 30C1.5 28.2031 2.90478 26.3113 5.94154 24.3756C8.94979 22.4581 13.419 20.59 19.2219 18.8004C30.8205 15.2236 47.6293 11.9957 68.4301 9.2826C110.025 3.85724 167.502 0.5 231 0.5C294.498 0.5 351.975 3.85724 393.57 9.2826C414.371 11.9957 431.18 15.2236 442.778 18.8004C448.581 20.59 453.05 22.4581 456.058 24.3756C459.095 26.3113 460.5 28.2031 460.5 30Z"
        //                     stroke="#B3B3B3" className="svg-elem-1"></path>
        //                 <path d="M460.86 21.9736C461.438 38.532 358.995 55.5491 232.047 59.9822C105.099 64.4153 1.71861 54.5858 1.14038 38.0273" stroke="#B3B3B3"
        //                     className="svg-elem-2"></path>
        //             </svg>
        //             &nbsp;
        //         </span> партнера, вдвое увеличивает
        //         количество квалифицированных лидов, которые
        //         партнер генерирует своим клиентам через
        //         традиционные инструменты.
        //         <div className="overlay"></div>
        //     </div>
        // ) : (
        //     <div className="partner_portrait_wrap-head section_title" ref={textRef}>
        //         Цель всех инструментов digital-маркетинга, от&nbsp;SEO до&nbsp;Я.
        //         Директа, одна&nbsp;-
        //         <span>
        //             &nbsp;
        //             генерация обращений,
        //             <svg width="462" height="68" viewBox="0 0 462 68" fill="none" xmlns="http://www.w3.org/2000/svg">
        //                 <path
        //                     d="M460.5 30C460.5 31.7969 459.095 33.6887 456.058 35.6244C453.05 37.5419 448.581 39.41 442.778 41.1996C431.18 44.7764 414.371 48.0043 393.57 50.7174C351.975 56.1428 294.498 59.5 231 59.5C167.502 59.5 110.025 56.1428 68.4301 50.7174C47.6293 48.0043 30.8205 44.7764 19.2219 41.1996C13.419 39.41 8.94979 37.5419 5.94154 35.6244C2.90478 33.6887 1.5 31.7969 1.5 30C1.5 28.2031 2.90478 26.3113 5.94154 24.3756C8.94979 22.4581 13.419 20.59 19.2219 18.8004C30.8205 15.2236 47.6293 11.9957 68.4301 9.2826C110.025 3.85724 167.502 0.5 231 0.5C294.498 0.5 351.975 3.85724 393.57 9.2826C414.371 11.9957 431.18 15.2236 442.778 18.8004C448.581 20.59 453.05 22.4581 456.058 24.3756C459.095 26.3113 460.5 28.2031 460.5 30Z"
        //                     stroke="#B3B3B3" className="svg-elem-1"></path>
        //                 <path d="M460.86 21.9736C461.438 38.532 358.995 55.5491 232.047 59.9822C105.099 64.4153 1.71861 54.5858 1.14038 38.0273" stroke="#B3B3B3"
        //                     className="svg-elem-2"></path>
        //             </svg>
        //             &nbsp;
        //         </span>
        //         так как
        //         бизнес ждет лиды и&nbsp;просит прогнозы по&nbsp;их&nbsp;приросту.
        //         Имплементация идентификации скрытых пользователей
        //         <span>
        //             &nbsp;
        //             в&nbsp;продуктовый портфель
        //             <svg width="462" height="68" viewBox="0 0 462 68" fill="none" xmlns="http://www.w3.org/2000/svg">
        //                 <path
        //                     d="M460.5 30C460.5 31.7969 459.095 33.6887 456.058 35.6244C453.05 37.5419 448.581 39.41 442.778 41.1996C431.18 44.7764 414.371 48.0043 393.57 50.7174C351.975 56.1428 294.498 59.5 231 59.5C167.502 59.5 110.025 56.1428 68.4301 50.7174C47.6293 48.0043 30.8205 44.7764 19.2219 41.1996C13.419 39.41 8.94979 37.5419 5.94154 35.6244C2.90478 33.6887 1.5 31.7969 1.5 30C1.5 28.2031 2.90478 26.3113 5.94154 24.3756C8.94979 22.4581 13.419 20.59 19.2219 18.8004C30.8205 15.2236 47.6293 11.9957 68.4301 9.2826C110.025 3.85724 167.502 0.5 231 0.5C294.498 0.5 351.975 3.85724 393.57 9.2826C414.371 11.9957 431.18 15.2236 442.778 18.8004C448.581 20.59 453.05 22.4581 456.058 24.3756C459.095 26.3113 460.5 28.2031 460.5 30Z"
        //                     stroke="#B3B3B3" className="svg-elem-1"></path>
        //                 <path d="M460.86 21.9736C461.438 38.532 358.995 55.5491 232.047 59.9822C105.099 64.4153 1.71861 54.5858 1.14038 38.0273" stroke="#B3B3B3"
        //                     className="svg-elem-2"></path>
        //             </svg>
        //             &nbsp;
        //         </span> партнера, вдвое увеличивает
        //         количество квалифицированных лидов, которые
        //         партнер генерирует своим клиентам через
        //         традиционные инструменты.
        //         <div className="overlay"></div>
        //     </div>
        // )
    );
}

export default PartnerPortraitHead;